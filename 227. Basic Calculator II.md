# 227. Basic Calculator II

链接：https://leetcode-cn.com/problems/basic-calculator-ii/

## slice 解法

```go
import "strconv"
import "strings"

func calculate(s string) int {
    operands, operators := []int{}, []byte{}
    for {
        n, op, str, ok := nextNumber(s)
        operands = append(operands, n)
        if !ok {
            break
        }
        operators = append(operators, op)
        s = str
    }

    operandsLeft := operands[:0]
    operatorsLeft := operators[:0]
    for i, j := 0, 0; i < len(operators); i++ {
        switch op := operators[i]; op {
        case '*':
            operands[j+1] *= operands[j]
        case '/':
            operands[j+1] = operands[j] / operands[j+1]
        default:
            operandsLeft = append(operandsLeft, operands[j])
            operatorsLeft = append(operatorsLeft, op)
        }
        j++
    }
    operandsLeft = append(operandsLeft, operands[len(operands)-1])

    operands, operators = operandsLeft, operatorsLeft
    for len(operators) != 0 {
        switch operators[0] {
        case '+':
            operands[1] += operands[0]
        case '-':
            operands[1] = operands[0] - operands[1]
        }
        operands, operators = operands[1:], operators[1:]
    }
    return operands[0]
}

func nextNumber(s string) (int, byte, string, bool) {
    offset := 0
    for ; offset<len(s) && 
        ((s[offset]!='+') && (s[offset]!='-') &&
         (s[offset]!='*') && (s[offset]!='/')); offset++ {}
    n, _ := strconv.Atoi(strings.TrimSpace(s[:offset]))
    if offset == len(s) {
        return n, 0, "", false
    }
    return n, s[offset], s[offset+1:], true
}
```

## 解法效果

![227. basic-calculator-ii](./img/227. basic-calculator-ii.png)

## 测试用例

```txt
"3+2*2"
"2+1"
" 3/2 "
" 3+5 / 2 "
"3*5/2"
"3+5-2"
"1+2+3-4*5+6*7/2-8+9*1"
" 123456 "
"0-2147483647"
"2-3"
```

